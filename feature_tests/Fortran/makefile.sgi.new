SHELL = /bin/sh

SHMEM_F90         = gfortran
SHMEM_F90CFLAGS   = -ggdb -O0 -fcray-pointer -lmpi -lsma -I/opt/sgi/mpt/mpt-2.03/include/
SHMEM_F90LFLAGS   = -ggdb -O0 -fcray-pointer -lmpi -lsma
TEST_RUNNER=testrunner.pl


# Please set these variables. They are used in execution time.
# #
# # the run command consists
# # > $RUNCMD $RUNOPT $NCOREOPT $NCORE[...] $NPROCOPT $NPROC[...]  executable

RUNCMD=oshrun
RUNOPT=
NCOREOPT=
NCORE=
NPROCOPT=-np
NPROC=2

F90_TESTS        = $(wildcard *.f90)

F90_EXES         = $(F90_TESTS:.f90=.x)

EXES             = $(F90_EXES)

.PHONY: clean all default

all default:    $(EXES)

.SUFFIXES: .x

%.x:    %.f90
	-$(SHMEM_F90) $(SHMEM_F90CFLAGS) $(SHMEM_F90LFLAGS) -o $@ $^

clean:
	rm -f $(EXES)

run: $(EXES)
	@perl ../${TEST_RUNNER}
